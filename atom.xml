<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Monitoring &amp; Integration Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Monitoring と Integration に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazmon-integ.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazmon-integ.github.io/blog/"/>
  <updated>2021-06-22T01:55:18.925Z</updated>
  <id>https://jpazmon-integ.github.io/blog/</id>
  
  <author>
    <name>Japan Azure Monitoring &amp; Integration Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Azure Monitoring &amp; Integration チームの Blog リニューアルのお知らせ</title>
    <link href="https://jpazmon-integ.github.io/blog/general/IntroduceOurBlog/"/>
    <id>https://jpazmon-integ.github.io/blog/general/IntroduceOurBlog/</id>
    <published>2021-06-16T03:00:00.000Z</published>
    <updated>2021-06-22T01:55:18.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Blog-リニューアルのお知らせ"><a href="#Blog-リニューアルのお知らせ" class="headerlink" title="Blog リニューアルのお知らせ"></a>Blog リニューアルのお知らせ</h2><p>こんにちは、Azure Monitoring &amp; Integration サポート チームです。<br>この度、Monitoring &amp; Integration サポート チームのブログをリニューアルいたしましたのでお知らせします！</p><span id="more"></span><p>こちらのブログでは、Monitoring や Integration 製品のテクノロジーに関する話題を中心に情報を発信していきます。<br>開発部門などからも多くの公式な公開情報を提供しておりますが、私たちのブログでは、新機能に関してのご紹介だけでなく、日本の多くの Azure ご利用者からサポートの依頼を直接受けているサポート エンジニアという立場から、時には私どもの視点を交えて、皆様のお役に立つ情報をご案内したいと思います。<br>これから本ブログで公開していく情報の一例を以下に記載しました。</p><h3 id="公開する情報の例"><a href="#公開する情報の例" class="headerlink" title="公開する情報の例"></a>公開する情報の例</h3><ul><li>リリースされたばかりの新機能に関する情報</li><li>よくサポート チームにお問い合わせいただく “あるある” な問題への対処方法</li><li>Azure を利用するユーザーの方に是非お伝えしたい情報 </li><li>ある問題についてサポートにお問い合わせいただく際、スムーズに調査を進めるために事前に採取いただきたい情報</li></ul><h3 id="本ブログで扱うテクノロジーの例"><a href="#本ブログで扱うテクノロジーの例" class="headerlink" title="本ブログで扱うテクノロジーの例"></a>本ブログで扱うテクノロジーの例</h3><ul><li>Azure Monitor</li><li>Azure Log Analytics</li><li>Azure Automation</li><li>Azure Application Insights</li><li>Azure Logic Apps</li><li>BizTalk Server</li><li>Host Integration Server</li><li>Microsoft Message Queue (MSMQ) Serve</li></ul><p>これから様々な情報を発信しますので、こちらのブログが皆さまのお役に立てれば幸いです。<br>また、実際のサポート サービスでは、製品動作に関する正式な見解のご提供、そして問題解決のサポートを行っていますので、こちらも併せてよろしくお願いいたします！</p><p>※ これまで公開していたフォーラムは以下のリンクからアクセスできますので、過去の情報はこちらからご確認ください。<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/home?forum=jpama">以前のフォーラム (アーカイブ) はこちら</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Blog-リニューアルのお知らせ&quot;&gt;&lt;a href=&quot;#Blog-リニューアルのお知らせ&quot; class=&quot;headerlink&quot; title=&quot;Blog リニューアルのお知らせ&quot;&gt;&lt;/a&gt;Blog リニューアルのお知らせ&lt;/h2&gt;&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームです。&lt;br&gt;この度、Monitoring &amp;amp; Integration サポート チームのブログをリニューアルいたしましたのでお知らせします！&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
  </entry>
  
  <entry>
    <title>Webhook の実行が ”(404) 見つかりません” で失敗する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/404ErrorOccurrWhenRunningWebhook/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/404ErrorOccurrWhenRunningWebhook/</id>
    <published>2019-04-02T17:27:00.000Z</published>
    <updated>2021-06-22T01:55:18.925Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure サポート チームの世古です。<br>今回は Azure Automation で Webhook を実行する際に記録されるエラー ”(404) 見つかりません” の原因および対処方法についてご案内させていただきます。</p><p>記録されるエラーについては以下の通りです。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR [TID:*] [] System.Net.WebException: リモート サーバーがエラーを返しました: (404) 見つかりません</span><br></pre></td></tr></table></figure><p>上記内容にあります通り、Runbook を実行しようとしたが実行する URL が見つからない為、404 のエラーを記録して、Runbook の実行に失敗します。</p><h1 id="対処方法について"><a href="#対処方法について" class="headerlink" title="対処方法について"></a>対処方法について</h1><p>URL が見つからない要因としては、一般的に Webhook 作成時に指定した URL の有効期限が影響している可能性がございます。<br>その為、まずは同様のエラーで失敗する場合には Webhook の有効期限をご確認ください。<br>有効期限が既に切れている場合には、Runbook で実行する事は出来ませんので、再度 Webhook を再作成くださいますようお願いします。<br>以下確認方法についてご紹介します。</p><p><img src="/blog/automation/404ErrorOccurrWhenRunningWebhook/SpecifyExpireOfWebhook.png" alt="Webhook での有効期限の指定" title="Webhook での有効期限の指定"></p><p><img src="/blog/automation/404ErrorOccurrWhenRunningWebhook/CheckExpirationDateWebhook.png" alt="Webhook の有効期限確認方法" title="Webhook の有効期限確認方法"></p><h1 id="参考-有効期限の指定について"><a href="#参考-有効期限の指定について" class="headerlink" title="参考 有効期限の指定について"></a>参考 有効期限の指定について</h1><p>Webhook で URL を指定して実行するのは簡単で便利ですが、URL の有効期限についてはセキュリティ面の観点でも非常に大事な項目となります。<br>例えば、外部トークンの URL が外部に漏れた場合には、誰でも Runbook が実行出来るようになるためです。<br>詳細は<a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-webhooks">公開情報</a>を確認いただければと存じますが、ただ長期の期間を指定するのではなく、適切な有効期限を指定する事を推奨しております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure サポート チームの世古です。&lt;br&gt;今回は Azure Automation で Webhook を実行する際に記録されるエラー ”(404) 見つかりません” の原因および対処方法についてご案内させていただきます。&lt;/p&gt;
&lt;p&gt;記録されるエラーに</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Webhook" scheme="https://jpazmon-integ.github.io/blog/tags/Webhook/"/>
    
  </entry>
  
  <entry>
    <title>Runbook の Update-AzureRmVM コマンドが &#39;Vhd&#39; cannot be null. で失敗する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/update-AzureRmVmCommandFailesWithVhdCannotBeNull/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/update-AzureRmVmCommandFailesWithVhdCannotBeNull/</id>
    <published>2019-04-02T17:26:00.000Z</published>
    <updated>2021-06-22T01:55:18.925Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Windows プラットフォーム サポートの世古です。<br>今回は Azure  Automation の Runbook 実行でよくお問い合わせいただく内容についてご紹介させていただきます。</p><p>Runbook の実行で Update-AzureRmVM が ‘Vhd’ cannot be null. で失敗する事象がございます。<br>この問題は以下の条件で発生します。</p><ul><li>対象の VM が管理ディスクを持つ</li><li>モジュールのバージョンが最新でない</li></ul><p>この問題はモジュールのバージョンを最新に更新いただく事で回避されますので、以下の公開情報の手順を実施下さい。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-update-azure-modules">Azure Automation の Azure PowerShell モジュールを更新する方法</a></li></ul><p>以前の Powershell モジュールにおいては、管理ディスクを操作可能な実装が含まれていなかった為、VM の情報を正常に取得出来なかった為、本問題が発生いたします。その為、モジュールのアップデートをご検討ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Windows プラットフォーム サポートの世古です。&lt;br&gt;今回は Azure  Automation の Runbook 実行でよくお問い合わせいただく内容についてご紹介させていただきます。&lt;/p&gt;
&lt;p&gt;Runbook の実行で Update-AzureR</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Runbook" scheme="https://jpazmon-integ.github.io/blog/tags/Runbook/"/>
    
  </entry>
  
  <entry>
    <title>Azure Automation にて特定期間のジョブの実行時間を取得する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/</id>
    <published>2019-04-02T17:15:00.000Z</published>
    <updated>2021-06-22T01:55:18.925Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure サポート チームの村田です。<br>Azure Automation においては昨年価格体系が変更されました</p><p>具体的には以下のように以前の Free、Basic という概念がなくなり、以下のように統合された価格体系となっております。</p><ul><li>以前の価格料金<ul><li>Free - 月あたり 500 分の無料時間が付与され、超過した場合はジョブが実行されなくなります。</li><li>Basic - 従量課金として、0.23円 / 分 で課金が発生します。</li></ul></li><li>変更後の価格体系<ul><li>無償の500分のジョブ実行時間が付与され、超過した分に関しましては、0.23円 / 分 で課金が発生します。</li></ul></li></ul><h2 id="参照情報"><a href="#参照情報" class="headerlink" title="参照情報"></a>参照情報</h2><ul><li>Automation の価格<ul><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/automation/">https://azure.microsoft.com/ja-jp/pricing/details/automation/</a></li></ul></li></ul><p>以前は Basic プランの場合、最初の1分から課金対象となっていましたが、新しいプランでは、必ず 月あたり 500 分の無料ジョブ実行時間がつくのでプラン的にはお得になってますね。</p><p>しかし、この価格体系の変更に伴い、Automation アカウントの画面内から、月のジョブの実行時間の累計を表示する項目が消えてしまいました。</p><p>したがいまして、今どの程度ジョブの実行時間を消費しているのかわからないとご質問をいただく場合がございます。</p><p>そんな場合に備え、今回はローカルから PowerShell を実行する事で、特定の期間のジョブの実行時間を取得するスクリプトをご案内します。</p><p>日別にジョブ実行時間が取得できるため、特定の日時のみジョブの実行時間がとても長い際などには、トラブルシューティングにも便利ですので是非ご利用ください。</p><h3 id="スクリプトの実行環境要件"><a href="#スクリプトの実行環境要件" class="headerlink" title="スクリプトの実行環境要件"></a>スクリプトの実行環境要件</h3><p>Windows 10またはWindows Server 2016でコンピュータを実行している場合は、すでにPowerShell 5以降がインストールされているため、この手順は必要ありません。</p><p>今回の場合、PowerShell のバージョンは 3.0 とのことですので、PowerShellを含むWindows Management Framework（WMF）の最新バージョンに更新する必要がございます。</p><ul><li>WMFの最新バージョンを入手するには、次のURLにアクセスしてください。<ul><li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=54616">https://www.microsoft.com/en-us/download/details.aspx?id=54616</a></li></ul></li><li>WMFとパッケージ管理へのリンクを含むPowerShell Galleryの使用に関する詳細は、下記を参照してください。<ul><li><a href="https://www.powershellgallery.com/">https://www.powershellgallery.com/</a></li></ul></li></ul><h2 id="Azure-RM-モジュールのインストール"><a href="#Azure-RM-モジュールのインストール" class="headerlink" title="Azure RM モジュールのインストール"></a>Azure RM モジュールのインストール</h2><p>AzureからPowerShell経由で情報を照会できるようにするには、Azure Resource Management（AzureRM）モジュールをインストールする必要があります。</p><p>先に進む前に、お使いのコンピュータがパッケージ管理の要件を満たしていることを確認してください。</p><p>AzureRMモジュールをインストールするには、以下の手順に従います。</p><ol><li>[管理者として実行]オプションを使用してPowerShellセッションを開きます。</li><li>Install-Module -Name AzureRM -Force -Verboseと入力し、Enterキーを押します。</li><li>インストールが完了するまで待ち、PowerShellのプロンプトに戻ります。</li><li>モジュールがインストールされたことを確認するために、Get-Module -Name AzureRM -ListAvailableと入力し、Enterキーを押します。</li></ol><h3 id="実行スクリプト"><a href="#実行スクリプト" class="headerlink" title="実行スクリプト"></a>実行スクリプト</h3><p>PowerShell ISE を起動し、以下のスクリプトを貼り付け、期間を指定して実行します。<br>※ブロックが複数にわかれておりますが、すべて一つのスクリプトに記載してください。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Add-AzureRMAccount | Write-Verbose</span><br><span class="line">#ジョブの実行時間を保存するディレクトリを記載します。</span><br><span class="line">$CSVFile = &quot;c:\temp\automation.csv&quot;</span><br><span class="line">#ジョブの実行時間を取得する期間の開始日時を指定します</span><br><span class="line">$StartTime = &quot;12/01/2017&quot;</span><br><span class="line">#ジョブの実行時間を取得する期間の終了日時を指定します</span><br><span class="line">$EndTime = &quot;12/08/2017&quot;</span><br><span class="line"></span><br><span class="line">#ジョブの実行時間を取得するサブスクリプションID を記載します</span><br><span class="line">$SubscriptionID = &#x27;Subscription ID&#x27;</span><br><span class="line">Set-AzureRmContext -SubscriptionId $SubscriptionID | Write-Verbose</span><br><span class="line"></span><br><span class="line">$UsageInfo = Get-UsageAggregates -ReportedStartTime $StartTime -ReportedEndTime $EndTime -AggregationGranularity Daily -ShowDetails $true</span><br><span class="line"></span><br><span class="line"> Do &#123; </span><br><span class="line">    $UsageInfo.UsageAggregations.Properties | Where-Object &#123;($_.MeterCategory -eq &#x27;Automation&#x27;) -and ($_.MeterName -eq &#x27;Basic Runtime&#x27;)&#125; | `</span><br><span class="line">            Select-Object `</span><br><span class="line">            UsageStartTime, `</span><br><span class="line">            UsageEndTime, `</span><br><span class="line">            @&#123;n=&#x27;SubscriptionId&#x27;;e=&#123;$SubscriptionId&#125;&#125;, `</span><br><span class="line">            MeterCategory, `</span><br><span class="line">            MeterId, `</span><br><span class="line">            MeterName, `</span><br><span class="line">            MeterSubCategory, `</span><br><span class="line">            MeterRegion, `</span><br><span class="line">            Unit, `</span><br><span class="line">            Quantity, `</span><br><span class="line">            @&#123;n=&#x27;Project&#x27;;e=&#123;$_.InfoFields.Project&#125;&#125;, `</span><br><span class="line">            InstanceData `</span><br><span class="line">            | Export-Csv -Append:$true -NoTypeInformation:$true -Path $CSVFile</span><br><span class="line">    if ($UsageInfo.NextLink) </span><br><span class="line">    &#123;</span><br><span class="line">        $ContinuationToken = [System.Web.HttpUtility]::UrlDecode($UsageInfo.NextLink.Split(&quot;=&quot;)[-1])</span><br><span class="line">        $UsageInfo = Get-UsageAggregates -ReportedStartTime $StartTime -ReportedEndTime $EndTime `</span><br><span class="line">                            -AggregationGranularity Daily -ShowDetails $true -ContinuationToken $ContinuationToken</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">       $ContinuationToken = &quot;&quot; </span><br><span class="line">   &#125;</span><br><span class="line"> &#125; Until (!$ContinuationToken)  </span><br></pre></td></tr></table></figure><p>なお実行時に下図のエラーが発生する場合は System.Web アセンブリがよみこまれていない可能性が高いため、以下のコマンドをローカルの環境にてご実施いただければと存じます。</p><p><img src="/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/ErrorMessage.jpg" alt="エラー画面" title="エラー画面"></p><p><strong>実行していただきたいコマンド</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Add-Type -AssemblyName System.Web</span><br></pre></td></tr></table></figure><p>結果として下図のように日時別のジョブの実行時間が CSV で取得できます。</p><p><img src="/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/CsvCreation.png"></p><p>”Quantity” 欄にて分単位でジョブの実行時間が表示されるのが確認できます。<br>この結果では 9 月で約67分のジョブ実行時間なので無償の範囲内ですね。<br>月別に出力して、管理することで、変遷を確認するなど運用にお役に立てていただければ幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure サポート チームの村田です。&lt;br&gt;Azure Automation においては昨年価格体系が変更されました&lt;/p&gt;
&lt;p&gt;具体的には以下のように以前の Free、Basic という概念がなくなり、以下のように統合された価格体系となっております。&lt;/</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Howto" scheme="https://jpazmon-integ.github.io/blog/tags/Howto/"/>
    
    <category term="Runbook" scheme="https://jpazmon-integ.github.io/blog/tags/Runbook/"/>
    
    <category term="Job" scheme="https://jpazmon-integ.github.io/blog/tags/Job/"/>
    
  </entry>
  
</feed>
