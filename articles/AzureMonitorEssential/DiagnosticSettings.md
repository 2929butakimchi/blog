---
title: 診断設定によるプラット フォーム メトリックやリソース ログの一部欠損について
date: 2022-09-28 00:00:00
tags:
  - Azure Monitor
  - Diagnostic settings
---

こんにちは！ Azure Monitoring チームの堀です。

最近、お客様から "診断設定でプラット フォーム メトリックを Azure ストレージにエクスポートした際に、一部のメトリックが欠損している" というお問い合わせをいただきました。

結論から申し上げますと、診断設定によるメトリックやリソース ログのエクスポートは、100 % のデータ エクスポートを保証しておりません。
システムの仕様上、一部のデータの欠損は発生する可能性がございますので、本ブログ記事にてご紹介いたします。

<br>

<!-- more -->
## 目次
- [診断設定とは](#診断設定とは)
- [診断設定によるメトリックやログの一部欠損](#診断設定によるメトリックやログの一部欠損)

<br>

## 診断設定とは
まず、Azure Monitor の診断設定の概要について簡単にご説明いたします。
診断設定を構成しますと、Azure リソースのメトリックや、リソース ログを Azure Storage アカウントや Azure Event Hubs 等に送信することができます。
詳細は下記弊社公開情報をご覧ください。

**メトリック**
監視対象のリソースから一定の間隔で自動で収集される数値データです。
既定では、Azure 基盤側のメトリック データベースに保存され、メトリックス エクスプローラから確認することができます。

**リソース ログ**
診断設定で出力されるリソース内部に関するログ (例 . 仮想マシンの CPU 使用率) です。
既定では収集されません。

<参考>
Azure Monitor の診断設定
https://learn.microsoft.com/ja-JP/azure/azure-monitor/essentials/diagnostic-settings?tabs=portal

Azure Monitor のサポートされるメトリック
https://learn.microsoft.com/ja-JP/azure/azure-monitor/essentials/metrics-supported

Azure プラットフォーム ログの概要
https://learn.microsoft.com/ja-JP/azure/azure-monitor/essentials/platform-logs-overview

<br>


## 診断設定によるメトリックやログの一部欠損
冒頭でも申し上げましたとおり、診断設定によるエクスポートでは、仕様上、メトリックやログの一部欠損は発生する可能性がございます。

診断設定は、 1 日あたりペタバイト単位のデータをお手頃な価格で、効率よくエクスポートすることを前提に設計されています。
そのため、完全なトランザクションは保証しておらず、ログやメトリックが一部欠損する可能性がございます。
なお、欠損したデータにつきましては、Azure 側で再出力することはできません。

一方で、一部の欠損ではなく、持続的にデータが欠損している場合や一度に大量のデータが欠損している場合は、
弊社 Azure サポート窓口までお問い合わせいただけますと幸いです。

<br>

以上、診断設定によるプラット フォーム メトリックやリソース ログの一部欠損についてご案内いたしました。
診断設定のシステムの制約上、一部欠損が発生し、その欠損したデータを再出力できない旨、予めご了承いただけますと幸甚です。
最後までお読みいただきありがとうございました。